#!/usr/bin/env bash
#
# Yao Zheng (zheng.iao@icloud.com)
# 2011/05/25-

cd "$(dirname "${BASH_SOURCE[0]}")" || exit 1
BASE=$(pwd)

if [ "$(uname -s)" = 'Darwin' ]; then
  # Homebrew
  [ -z "$(which brew)" ] &&
    ruby -e "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)"

  # Taps (third-party repositories)
  brew tap waltarix/homebrew-customs
  brew tap universal-ctags/universal-ctags

  # Languages
  brew install ruby python go

  # Shells
  brew install zsh fish bash-completion

  # Terminal
  brew install waltarix/homebrew-customs/tmux reattach-to-user-namespace

  # Email
  brew install neomutt/homebrew-neomutt/neomutt \
                 --with-sidebar-patch --with-notmuch-patch --HEAD \
               isync msmtp notmuch lbdb terminal-notifier lmdb

  # FZF
  brew install fd ag ripgrep jq highlight html2text
  brew install --HEAD https://raw.githubusercontent.com/junegunn/blsd/master/blsd.rb
  brew cask install pdftotext
  if [ ! -e ~/.local/bin/z.sh ]; then
    curl https://raw.githubusercontent.com/rupa/z/master/z.sh -o ~/.local/bin/z.sh
  fi

  # VIM
  brew install neovim cscope
  brew install --HEAD universal-ctags
  gem install gem-ctags
  gem ctags

  # Libraries
  brew install liboauth

  # Commandline software
  brew install coreutils wget tree git stow dtrx \
       ant leigingen sbt maven hugo \
       exiftool doxygen graphviz imagemagick gnuplot --with-qt@5.7 \
       ranger cmus

  # Apps
  brew cask install iterm2 xquartz dropbox spectacle flycut keycastr flux
fi

# bin
mkdir -p ~/.local/bin
stow --no-folding -t ~/.local/bin -d $BASE/bin

# cfg-core
stow --no-folding -t $BASE/cfg-core

# git-prompt
if [ ! -e ~/.git-prompt.sh ]; then
  curl https://raw.githubusercontent.com/git/git/master/contrib/completion/git-prompt.sh -o ~/.git-prompt.sh
fi

# vim and nvim
export GIT_SSL_NO_VERIFY=true
mkdir -p ~/.vim/autoload
curl --insecure -fLo ~/.vim/autoload/plug.vim https://raw.github.com/junegunn/vim-plug/master/plug.vim

mkdir -p ~/.config/nvim/autoload
ln -sf ~/.vim/autoload/plug.vim ~/.config/nvim/autoload/

vim +PlugInstall +qall

# tmux
tmux source-file ~/.tmux.conf
